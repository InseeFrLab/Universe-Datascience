{
    "id": "{{service.name}}",
    "cpus": {{service.cpus}},
    "mem":  {{service.mem}},
    "instances":1,
    "cmd": "{{#advanced.jupyter_lab}} start.sh jupyter-lab {{/advanced.jupyter_lab}} {{^advanced.jupyter_lab}} start-notebook.sh {{/advanced.jupyter_lab}} {{#advanced.security_token.enable}} --NotebookApp.token='{{advanced.security_token.password}}'{{/advanced.security_token.enable}} {{^advanced.security_token.enable}} --NotebookApp.token=''{{/advanced.security_token.enable}}",
    "env": {
        "AWS_ACCESS_KEY_ID" : "{{s3.accessKeyId}}",
        "AWS_S3_ENDPOINT" : "{{s3.endpoint}}",
        "AWS_DEFAULT_REGION" : "{{s3.defaultRegion}}",
        "AWS_SECRET_ACCESS_KEY" : "{{s3.secretAccessKey}}",
        "AWS_SESSION_TOKEN" : "{{s3.sessionToken}}",
        "AWS_EXPIRATION" : "{{s3.expiration}}"
    },
    "container": {
        "type": "DOCKER",
        "docker": {
            "image": "{{resource.assets.container.docker.jupyter}}",
            "portMappings": [
                { "containerPort": 8888 , "name": "jupyter"}
            ]
        }
    },
    "networks": [
      {
        "name": "dcos",
        "mode": "container"
      }
    ],
    "healthChecks": [{
        "protocol": "MESOS_TCP",
        "gracePeriodSeconds": 300,
        "intervalSeconds": 60,
        "portIndex": 0,
        "timeoutSeconds": 15,
        "maxConsecutiveFailures": 3
    }],
    "labels": {
        "HAPROXY_GROUP": "external",
        "HAPROXY_0_VHOST": "{{networking.virtual-host}}",
        "HAPROXY_0_REDIRECT_TO_HTTPS": "{{networking.https-redirect}}",
        "HAPROXY_0_FRONTEND_HEAD": "",
        "HAPROXY_0_FRONTEND_BACKEND_GLUE": "",
        "HAPROXY_0_ENABLED":"true",
        {{#networking.whitelist.enable}}
        "HAPROXY_0_BACKEND_NETWORK_ALLOWED_ACL": "{{networking.whitelist.ip}}",
        {{/networking.whitelist.enable}}
        "MARATHON_SINGLE_INSTANCE_APP": "true"
    },
    "fetch": [
    ],

    "upgradeStrategy": {
       "maximumOverCapacity": 0,
       "minimumHealthCapacity": 0
    }
}
